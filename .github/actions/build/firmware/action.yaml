inputs:
  release_url: 
    description: 'The URL of the Release to upload assets to'
  release: 
    description: 'Whether to push assets to this release or just run the build'
    default: false
runs:
  using: "composite"
  steps: 
    # set version
    - name: set version
      run: |
        echo "VERSION=${{ steps.get_version.outputs.VERSION }}" >> $GITHUB_ENV

    # compile gui app for linux/amd64
    - name: build project for linux/amd64
      run: |
        make firmware

    # zip assets
    - name: copy asset
      if: ${{release}}
      run: |
        cp ./dist/firmware/main.uf2 /home/runner/work/flowcontrol-${VERSION/./-}.uf2

    # upload linux x64 asset
    - name: Upload firmware asset
      if: ${{release}}
      id: upload-firmware-asset 
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: /home/runner/work/flowcontrol-${VERSION/./-}.uf2
        asset_name: flowcontrol-${VERSION/./-}.uf2
        asset_content_type: application/octet-stream
